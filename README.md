# Reinforcement Portfolio Trader (EIIE)

## 개요

이 프로젝트는 **EIIE(Ensemble of Identical Independent Evaluators)** 구조를 적용한 강화학습 기반 산업 포트폴리오 트레이딩 모델 구현을 목적으로 합니다. 전통적인 기술적 지표나 단순 가격 패턴 기반 접근법 대신, **산업 ETF 가격, 시가총액, 재무제표 항목, 주요 거시지표**를 결합해 학습 데이터를 구성하였으며, 정책 신경망으로 CNN 기반의 EIIE를 활용했습니다. 학습된 에이전트는 시점별 포트폴리오 가중치를 동적으로 조정하며, Buy and Hold 전략과 비교 평가되었습니다.

---

## 데이터 및 전처리

* **출처**: DataGuide (산업별 주재무제표, ETF 가격, 산업별 시가총액, 주요 거시경제 지표)
* **투자 대상**: KRX 산업지수를 기초로 한 ETF (건설, 기계장비, 반도체, 방송통신, 보험, 에너지화학, 운송, 은행, 자동차, 증권, 철강, 헬스케어 총 12개 산업)
* **재무 데이터**: 주재무제표 기준 17개 재무상태표 항목 + 4개 손익계산서 항목
* **거시 지표**: 주요 상품 가격(금, 니켈, 원유 등 7종), 채권 수익률(5종), 환율(3종)
* **기간**: 2014-04-02 ~ 2025-01-31 (일별 영업일)

### 핵심 전처리

| 항목       | 처리 내용                                          |
| -------- | ---------------------------------------------- |
| 공시 시차 반영 | 분기 공시 지연 반영 (1Q→6월, 2Q→8월, 3Q→12월, 4Q→다음 해 4월) |
| 로그 변환    | 0 이상 값만 로그 변환, 0 이하는 그대로 유지                    |
| 음수 항목 처리 | 음수 항목 별도 분리(`영업이익(-)` 등) 후 로그 변환               |

재무 항목 중 음수가 발생할 수 있는 영업이익·순이익·포괄이익 등은 단순 로그 변환이 불가능하기 때문에 음수가 가능한 항목에 대해 부호를 반전시킨 파생 변수를 만들어 로그 변환을 적용하였습니다.

---

## 모델 설계

* **환경**: PortfolioOptimizationEnv (FinRL 기반), 초기 자본 100,000, 거래 비용 0.12%
* **정책 신경망**: EIIE (1D CNN 기반, Conv mid 30 / Conv final 20)
* **강화학습 알고리즘**: Policy Gradient (PG)
* **학습 파라미터**:

  * Time Window: 15개월
  * Features: 41개
  * Batch Size: 128
  * Episodes: 200
  * Reward Scaling: 0.99995

EIIE는 자산별 과거 데이터를 CNN으로 평가하고, 각 자산의 향후 성장 가능성을 반영해 가중치를 산출합니다. 이는 과거 성과가 낮아도 잠재력이 높은 산업을 포트폴리오에 포함할 수 있도록 설계되었습니다.

---

## 성과 평가

* **비교 대상**: Buy and Hold (균등비중) 전략
* **성과 지표**: Sharpe, Sortino, Omega, CAGR, 누적수익률, MDD

### 성과 지표 비교표

| 구간             | 전략         | Sharpe | Sortino | Omega | CAGR | 누적수익률 | MDD    |
| -------------- | ---------- | ------ | ------- | ----- | ---- | ----- | ------ |
| 학습 (2014–2021) | EIIE       | 0.488  | 0.642   | 1.12  | 8.3% | 2.244 | -21.3% |
|                | Buy & Hold | 0.173  | 0.198   | 1.02  | 3.5% | 1.414 | -28.4% |
| 평가 (2021–2025) | EIIE       | 0.162  | 0.205   | 1.05  | 3.6% | 1.171 | -17.5% |
|                | Buy & Hold | -0.042 | -0.051  | 0.98  | 1.1% | 1.046 | -31.2% |

EIIE는 학습 및 평가 구간 모두에서 Buy and Hold보다 낮은 MDD와 개선된 위험조정 성과 지표를 기록하며, 안정성과 효율성 측면에서 우위를 보였습니다.

---

## 의의

본 프로젝트는 **산업 ETF, 재무, 거시 지표를 결합한 데이터셋으로 EIIE 기반 강화학습을 실제 포트폴리오 문제에 적용**했다는 점에서 의미가 있습니다. 특히 분기 공시 지연을 반영한 시계열 처리와 단순 전략 대비 성과 개선을 확인함으로써 강화학습 기법의 적용 가능성을 검증했습니다.
