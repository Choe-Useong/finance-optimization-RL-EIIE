# 강화학습 기반 산업 포트폴리오 트레이딩 (EIIE)

## 프로젝트 개요

이 프로젝트는 산업 ETF 가격, 재무지표, 거시 변수 데이터를 통합하여 입력 행렬을 만들고, 이를 기반으로 EIIE 신경망 구조와 Policy Gradient 기반 강화학습을 적용해 산업 포트폴리오 최적화를 수행한 것입니다.

EIIE(Ensemble of Identical Independent Evaluators)는 1차원 시계열 합성곱(Conv1D) 구조를 활용해 자산별 입력 특징을 처리하고, Softmax 출력을 통해 포트폴리오 비중을 직접 산출하는 방식의 정책 신경망입니다. 기존의 단순 선형회귀나 MPT 기반 접근과 달리, 시계열 패턴을 학습하여 동적인 자산 배분 전략을 생성할 수 있다는 점에서 장점을 가집니다.

---

## 데이터 및 특징 엔지니어링

* **데이터 소스**: 산업 ETF 일별 가격, 산업별 시가총액, 재무제표 분기치, 거시경제 변수(금리·환율·원자재).
* **공시 지연 반영**: 재무제표 발표 시차를 현실적으로 이동(1Q→6월, 2Q→8월, 3Q→12월, 4Q→익년 4월).
* **결측 처리**: `groupby().ffill()`로 구간 보정 후, 잔여 NaN은 0으로 치환.
* **음수 처리**: 당기순이익·영업이익·포괄손익은 음수 전용 컬럼 생성(`(-)`), 원본은 0으로 대체.
* **로그 변환**: 0 초과 값만 log, 음수/0은 그대로 유지.
* **리샘플링**: 월초(MS) 단위로 통일, 최종적으로 41개 핵심 피처를 고정 순서로 정리.

---

## 학습 및 평가

* **환경 (PortfolioOptimizationEnv)**

  * 초기자본: 100,000
  * 거래비용: 0.12%
  * 입력 피처: 41개
  * time window: 15개월
  * 보상 스케일링: 0.99995

* **정책 신경망 (EIIE)**

  * Conv1D 기반 공유 커널 구조
  * Conv mid features: 30
  * Conv final features: 20

* **학습 알고리즘**: Policy Gradient (PG)

  * lr: 0.0001
  * batch size: 128
  * episodes: 200

---

## 성과 비교

모델 학습 결과는 **Buy & Hold(균등비중) 전략**과 비교되었습니다.

평가 지표 (QuantStats 활용):

* Sharpe Ratio
* Sortino Ratio
* CAGR (연평균 복리수익률)
* MDD (최대낙폭)
* Omega Ratio

EIIE 모델은 Sharpe 및 Sortino 측면에서 우위를 보였으며, 산업별 비중을 동적으로 조절해 낙폭을 제한하면서 성장성을 확보하는 모습을 확인할 수 있었습니다.

---

## 의의

* 다양한 산업, 재무, 거시 데이터를 통합하여 강화학습 모델을 학습해본 실험입니다.
* 단순 Buy & Hold 전략과 비교해, 강화학습 기반 접근이 어떤 성과 차이를 보이는지 확인했습니다.
* 포트폴리오 자산 배분 문제에 강화학습을 적용할 수 있음을 검증한 예시로 의미를 가집니다.
