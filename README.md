# Reinforcement Portfolio Trader (EIIE)

산업별 재무·거시·ETF 지표를 결합하여 **EIIE 구조 기반 강화학습 에이전트**를 학습·평가하는 파이프라인입니다.
데이터 전처리부터 환경 설정, 학습 및 성과 평가, 산출물까지 전체 과정을 재현할 수 있도록 구성했습니다.

---

## 저장소 구성

| 파일명                            | 역할                           | 비고              |
| ------------------------------ | ---------------------------- | --------------- |
| `전처리.py`                       | 원천 데이터(엑셀 시트)에서 학습용 특징 행렬 구축 | 데이터 품질 관리       |
| `EIIE 강화학습.py`                 | FinRL 기반 EIIE + PPO 학습 및 평가  | 포트폴리오 강화학습 에이전트 |
| `requirements.txt`             | 실행 환경 패키지 목록                 | 재현성 보장          |
| `강화학습 기반 산업 포트폴리오 트레이딩 모델.pdf` | 실험 결과 요약                     | 참고 자료           |

---

## 입력 데이터 규격

* 단일 엑셀(`산업통합.xlsx`) 파일 내 시트:

  * `산업`: ETF 가격
  * `산업별시가총액`: 산업별 시가총액
  * `산업별경제지표`: 금리, 환율, 원자재 등 거시 변수
  * `ETF구성`: ETF 메타데이터
* 조건:

  * 날짜는 Excel 기본 형식, `time` 컬럼 유지
  * 종목명은 문자열로 제공, 공백·특수문자 제거 후 규칙화
  * 결측·0 값 허용 → 전처리 단계에서 보간·로그 변환 처리
* 권장: UTF-8 인코딩, 프로젝트 루트 배치

---

## 전처리 파이프라인 (`전처리.py`)

1. **시트 정리 및 규칙화**

   * 불필요 열 제거, 산업명 규칙화, `melt→pivot` 변환
   * 재무제표 발표 지연 반영 (실제 공시 시차 고려)
2. **타임라인 확장 및 병합**

   * 구간: 2004-04-01 ~ 2025-01-31
   * forward-fill 적용, 산업·재무·거시 outer join
3. **수치 변환 및 정규화**

   * ETF 가격: 기준월 대비 1로 스케일링
   * 재무·거시 변수: 로그 변환, 음수는 별도 컬럼 처리
4. **리샘플링 및 피처 선택**

   * 월초(MS) 리샘플링
   * 41개 핵심 피처 고정 선택
5. **산출물**

   * `산업별통합데이터.xlsx`: 최종 학습 입력
   * `통합데이터.xlsx`, 스냅샷(`...1.xlsx`) → 점검용

---

## 학습 파이프라인 (`EIIE 강화학습.py`)

1. **데이터 로드 및 구간 분할**

   * 학습: 2014-04-02 ~ 2021-03-31
   * 평가: 2021-04-01 ~ 2025-01-31
   * 동일 종목 유지, 결측 제거
2. **환경 설정**

   * 특징 수 41, 윈도우 15개월, 거래비용 0.12%, 초기자본 100,000
   * 보상 스케일링 0.99995
   * GPU 사용 가능 시 자동 선택
3. **모델 학습**

   * 구조: FinRL EIIE (1D Conv, Shared Kernel, Softmax)
   * 알고리즘: PPO (배치 128, GAE 적용)
4. **성과 평가**

   * 포트폴리오 가치·비중 시계열 기록
   * 벤치마크: Buy & Hold(균등 비중)
   * 지표: Sharpe, Sortino, MDD, CAGR, Omega

---

## 산출물

| 파일명                                       | 내용                                  |
| ----------------------------------------- | ----------------------------------- |
| `train_portfolio_data.xlsx`               | 학습 구간 포트폴리오 가치 시계열                  |
| `test_portfolio_data.xlsx`                | 평가 구간 포트폴리오 가치 시계열                  |
| `weights_train.xlsx`, `weights_test.xlsx` | 자산별 비중 행렬                           |
| 콘솔 로그                                     | Sharpe, Sortino, MDD, CAGR, Omega 등 |

---

## 실행 절차

1. 의존성 설치: `pip install -r requirements.txt`
2. 데이터 배치: 원본 엑셀을 루트에 위치
3. 전처리 실행: `python 전처리.py`
4. 학습/평가 실행: `python EIIE 강화학습.py`
5. 산출물 확인: 엑셀 및 로그 결과 검토

---

## 환경·호환성

* 인코딩: UTF-8 (윈도우 한글 경로 대응)
* 엑셀 엔진: `openpyxl` 권장
* 하드웨어: CPU/GPU 모두 실행 가능

---

## 결론 및 활용 방향

산업·거시·ETF 데이터를 통합한 **강화학습 기반 포트폴리오 모델**을 재현 가능한 형태로 제공합니다.
이 파이프라인은 전략 백테스트, 리스크 관리, 실거래 적용 연구의 기반으로 활용할 수 있습니다.
